/**
 * 
 */
package com.dhaval.service;

import java.io.IOException;
import java.sql.PreparedStatement;
import java.sql.SQLException;


import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.dhaval.connection.DBConnection;
import com.dhaval.model.Users;

/**
 * @author DHS
 *
 */
@WebServlet("/SubmitData")
public class SubmitData extends HttpServlet{

	/**
	 * 
	 */
	private static final long serialVersionUID = -3572308527301317265L;

	public void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
	
		Users users = new Users();
		users.setFirstName(request.getParameter("firstName"));
		users.setMiddleName(request.getParameter("middleName"));
		users.setLastName(request.getParameter("lastName"));
		//String dob = request.getParameter("dob");
		/*DateFormat df = new SimpleDateFormat("dd-mm-yyyy");
	    Date date = null;
	    String stringDate = null;
	    try {
	        date = df.parse(dob);
	        stringDate = df.format(date);
	    } catch (ParseException e) {
	       e.printStackTrace();
	    }*/
	    
		System.out.println("The data in servlet: " + request.getParameter("firstName"));
		
		//users.setDateOfBirth(java.sql.Date.valueOf(request.getParameter("dob")));
		users.setGender(request.getParameter("gender"));
		long aadhaar = Long.parseLong(request.getParameter("aadhaar"));
		System.out.println("Aadhaar no: " + aadhaar);
		users.setAadhaar_no(aadhaar);
		users.setContact(Long.parseLong(request.getParameter("contact")));
		users.setAddress(request.getParameter("address"));
		users.setCity(request.getParameter("city"));
		users.setProvince(request.getParameter("province"));
		users.setPincode(Integer.parseInt(request.getParameter("pincode")));
		users.setEmail(request.getParameter("email"));
		users.setUsername(request.getParameter("username"));
		users.setWebsite(request.getParameter("website"));
		users.setPasscode(request.getParameter("password"));
		users.setStatus("PENDING");
		
		
		PreparedStatement stmt;
		try {
			stmt = DBConnection.getConnection().prepareStatement("insert into Users values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
			
			stmt.setString(1,users.getFirstName());			
			stmt.setString(2,users.getMiddleName());
			stmt.setString(3,users.getLastName());
			stmt.setString(4,users.getGender());
			stmt.setString(5,users.getAddress());
			stmt.setString(6,users.getCity());
			stmt.setInt(7,users.getPincode());
			stmt.setString(8,users.getProvince());
			stmt.setLong(9, users.getContact());
			stmt.setLong(10, users.getAadhaar_no());
			stmt.setString(11,users.getEmail());
			stmt.setString(12,users.getWebsite());
			stmt.setString(13,users.getUsername());
			stmt.setString(14,users.getPasscode());
			stmt.setString(15,users.getStatus());
			
			int i=stmt.executeUpdate();
			
			if(i == 1){
				response.sendRedirect("guestIndex.jsp");
			}
			System.out.println("Fields entered:" + i);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}  
		  
		  
		
		
		//Session session = HibernateUtil.getSessionFactory().openSession();
	    /*Session session = new HibernateUtil().getSession();
		session.beginTransaction();
	    
	    session.save(users);*/
	    
	    // Check database version
	    /*String sql = "select version()";

	    String result = (String) session.createNativeQuery(sql).getSingleResult();
	    System.out.println(result);*/

	   /* session.getTransaction().commit();
	    session.close();*/

	    
	    //HibernateUtil.shutdown();
	  
	}
}
